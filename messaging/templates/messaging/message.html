{% extends "manager/layout.html" %}

{% block title %}
Message - {{ message.subject }}
{% endblock %}

{% block main %}
<div class="container">
    <div class="d-flex justify-content-between">
        <h1 class="fw-light">Messages</h1>
        <a class="btn btn-outline-secondary m-2" href="{% url "messaging:messages_overview" %}">Back</a>
    </div>
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <a href="{% url 'teams:team_owner' message.sender.team.id %}" class="text-decoration-none text-dark fw-bold">{{ message.sender.name }}</a>
            to
            <a href="{% url 'teams:team_owner' message.receiver.team.id %}" class="text-decoration-none text-dark fw-bold">{{ message.receiver.name }}</a>
        </div>
        {% if message.receiver == current_user_manager %}
        <form action="{% url 'messaging:message' message.id %}" method="post" role="form">
            {% csrf_token %}
            <input hidden type="text" name="delete_letter_id" value="{{ message.id }}">
            <input class="btn rounded-3 btn-danger" type="submit" value="X">  
        </form>
        {% endif %}
    </div>
    <h3 class="fw-light">{{ message.subject }}</h3>    
    <hr class="my-1"> 
    <p>
        {{ message.content }}
    </p>
    <div class="d-flex gap-2 align-items-center mb-2">
        {% if message.sender != current_user_manager %}
            <button class="btn btn-primary" id="reply_btn">Reply</button>
        {% endif %}
        <a href="{% url 'messaging:messages_overview' %}"><button class="btn btn-secondary">Back</button></a>
    </div>
    <form action="{% url 'messaging:message' message.id %}" style="display: none;" method="post" role="form" id="reply_form">
        {% csrf_token %}
        <input type="text" class="form-control mb-2" name="topic_reply" value="Re: {{ message.subject }}" maxlength="104">
        <textarea class="form-control mb-2" id="message_reply" name="message_reply" rows="8" maxlength="1000"></textarea>
        <input class="btn btn-secondary" type="submit" value="Send">
    </form>
</div>

    <script defer>
        const replyBtn = document.querySelector('#reply_btn');
        const replyForm = document.querySelector('#reply_form');
        replyBtn.addEventListener('click', () => {
            replyBtn.style.display = 'none';
            replyForm.style.display = 'block';
        })
    </script>

{% endblock %}